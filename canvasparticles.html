<!DOCTYPE html>
<html>
<head>
	<title>Interactive backgrounds</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0 user-scalable=0">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Gugi" rel="stylesheet">

<style>
body {
	margin: 0; 
	padding: 0;
	font-family: 'Gugi', cursive;
	width: 100vw;
	height: 100vh;
	overflow: hidden;
}
#canvas1 {
	position: absolute;
	width: 100%;
	height: 100%;
	z-index: -1000;
	//display: none;
	overflow: hidden;
	background: linear-gradient(#25364f, #4d71a5, #9bc4ff);
}
#controlsWrapper {
	position: absolute;
	width: auto;
	min-width: 260px;
	height: 152px;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
}
#controls {
	position: absolute;
	width: 260px;
	height: 152px;
	//background: rgba(255,255,255,.1);
	top: 0;
	left: 0;
	z-index: 100;
	border-radius: 5px;
}

/*
#controls:before {
	content: 'Interactive backgrounds';
	position: absolute;
	bottom: -23px; left: -44px;
	width: 150%;
	height: 30px;
	color: rgba(255,255,255,0.8);
	font-size: 22px;
	z-index: 10;
	transform: rotate(10deg);
	overflow: hidden;
}*/
.button {
	position: relative;
	top:0; left: 0;
	float: left;
	width: 41.3px; height: 50px;
	background: rgba(0,0,0,.5);
	margin-right: 2px;
	border-radius: 5px;
	text-align: center;
	line-height: 50px;
	font-size: 30px;
	color: #000;
	transition: .5s;
}

.button:hover, .button.active {
	background: rgba(0,0,0,.9);
	color: #fff;
}
.infoBoard1 {
	position: relative;
	width: 242px;
	margin-top: 2px;
	height: 40px;
	top:0; left:0;
	float: left;
	background: rgba(0,0,0,.8);
	border-radius: 5px;
	padding: 0px 8px;
	text-align: justify;
	font-size: 15px;
	line-height: 16px;
	color: #fff;
	overflow: visible;
}
.infoBoard2 {
	position: relative;
	width: 242px;
	margin-top: 2px;
	height: 50px;
	top:0; left:0;
	float: left;
	background: rgba(0,0,0,.8);
	border-radius: 5px;
	padding: 8px;
	text-align: justify;
	font-size: 12px;
	line-height: 16px;
	color: #fff;
	overflow: hidden;
}
.p_current {
	line-height: 10px;
	margin-top: -3px;
}
.p_color {
	position: absolute;
	top: -8px; left: 3px;
	width: 242px;
	padding: 6px;
}
#slider {
	width: 175px;
	float: right;
	position: absolute;
	top: 2px; right: 10px;
}
/********************************** INFO **************************************/
.info {
	position: absolute;
	top: 15px;
	left: 15px;
	width: 35px; 
	height: 35px;
	background: rgba(0,0,0,.5);
	border-radius: 5px;
	transition: .5s;
	color: white;
	font-size: 20px;
	text-align: center;
	line-height: 35px;
	z-index: 100;
	overflow: hidden;
	padding: 0 0;
}
.info:hover {
	background: rgba(0,0,0,.9);
	width: 210px;
	height: 210px;
	padding: 0 10px;

}
.info:hover p{
	opacity: 1;
}
.info h3 {
	font-size: 15px;
	width: 200px;
	text-align: center;
	line-height: 10px;
}
.info p {
	font-size: 11px;
	line-height: 12px;
	padding: 5px;
	text-align: left;
	opacity: 0;
	transition: 1s;
	width: 200px;
}
.info a {
	font-size: 8px;
	text-decoration: none;
	line-height: 12px;
	color: white;
}

/********************************** TOOLTIP **************************************/
.tooltip {
	filter: url(#goo);
}
.tooltip .bubble {
	position: absolute;
	background: #000;
	border-radius: 50%;
	color: white;
	font-size: 9px;
	text-align: center;
	animation: move 10s forwards;
	transform: scale(0);
}
.tooltip .bubble1 {
	top:-10px; left:-10px;
	width: 20px; height: 20px;
	animation-delay: 0.6s;
}
.tooltip .bubble2 {
	top:-30px; left:-50px;
	width: 45px; height: 45px;
	animation-delay: 0.25s;
}
.tooltip .bubble3 {
	top:-20px; left:-120px;
	width: 85px; height: 85px;
	line-height: 90px;
	animation-delay: 0s;
}
.tooltip2 .bubble1 {
	top:10px; left:-20px;
	width: 20px; height: 20px;
}
.tooltip2 .bubble2 {
	top:25px; left:-40px;
	width: 40px; height: 40px;

}
.tooltip2 .bubble3 {
	top:40px; left:-115px;
	width: 95px; height: 95px;
	line-height: 90px;
}
@keyframes move {
	0% {transform: scale(0);}
	20% {transform: scale(0);}
	35% {transform: scale(1.3);}
	44% {transform: scale(0.85);}
	55% {transform: scale(1.1);}
	65% {transform: scale(0.85);}
	75% {transform: scale(1.1);}
	80% {transform: scale(0.85);}
	97% {transform: scale(1.15);}
	100% {transform: scale(0);}
}
svg {
	display: none;
}
/**************************************************************************/
/**************************************************************************/
/********************** SMALL SCREENS (mobile) ****************************/
/**************************************************************************/
/**************************************************************************/
@media screen and (max-width: 450px){
	.tooltip {
		display: none;
	}
}
</style>
<body>
<canvas id='canvas1'></canvas>	
<div class='info'><i class="fas fa-info"></i>
	<h3>Interactive Backgrounds</h3>
	<p>Moving particles that react to mouse position/touch input. This code can be used as an interactive background for a website</p>
	<p>Source code:
	<a href='#'>github.com/fdvorak/canvasparticles</a></p>
</div>
<div id='controlsWrapper'>
	<div id='controls'>		
		<div class='button button1 active' data-mode='Floating'>1</div>
		<div class='button button2' data-mode='Snow'>2</div>
		<div class='button button3' data-mode='Cross streams'>3</div>
		<div class='button button4' data-mode='Bouncing'>4</div>
		<div class='button button5' data-mode='Bubbles'>5</div>
		<div class='button button6' data-mode='Fog'>6</div>
		<div class='button button7' data-mode='Falling trail'>7</div>
		<div class='button button8' data-mode='New'>8</div>
		<div class='tooltip tooltip1'>
			<div class='bubble bubble1'></div>
			<div class='bubble bubble2'></div>
			<div class='bubble bubble3'>Change movement</div>
		</div>
		<div class='infoBoard1'>
			<div class='tooltip tooltip2'>
				<div class='bubble bubble1'></div>
				<div class='bubble bubble2'></div>
				<div class='bubble bubble3'>Change colours</div>
			</div>
			<p class='p_color'>color: <input type='range' id='slider' name='slider' min='1' max='4' value='1'></p>
		</div>
		<div class='infoBoard2'>
		<p class='p_current'>
		</p>
		</div>
	</div>
</div>
<svg>
	<defs>
		<filter id='goo'>
			<feGaussianBlur in='SourceGraphic' stdDeviation='10' result='blurName'/>
			<feColorMatrix in='blurName' mode='matrix' values='	1 0 0 0 0
															0 1 0 0 0 
															0 0 1 0 0
															0 0 0 16 -8 ' result='martixName'/>
			<feBlend in='SourceGraphic' in2='martixName'/>
		</filter>
	</defs>
</svg>
<script>
let activeEffect = 1;
// CANVAS ///////////////////////////////////
const canvas = document.getElementById("canvas1");
const ctx = canvas.getContext("2d");
ctx.canvas.width  = window.innerWidth;
ctx.canvas.height = window.innerHeight;

// VARIABLES ///////////////////////////////////
const slider = document.querySelector('#slider');
let particleArray = [];
let angle = 0;
let sliderValue = 1;
const p_current = document.querySelector(".p_current");
let current_colour = 'Stratosphere';
let activeMode = 'Floating';
const tooltips = document.querySelectorAll('.tooltip');

// REMOVE TOOLTIPS AFTER 15SEC //////////////
setTimeout(function(){
	console.log('tooltips removed from DOM');
	tooltips.forEach(tooltip => tooltip.style.display='none');
}, 15000);

// MOUSE POSITION ///////////////////////////
let mouse = {
	x: undefined,
	y: undefined
}
let touch = {
	x: undefined,
	y: undefined
}

setInterval(function(){
	mouse.x = undefined;
	mouse.y = undefined;
	Touch.clientX = undefined;
	Touch.clientY = undefined;
}, 5000);

window.addEventListener('mousemove', 
	function(event){
		mouse.x = event.x;
		mouse.y = event.y;
		//console.log(mouse);
});

// RANGE OF SIZES FOR PARTICLES (on mouse hover)
let maxSize = innerWidth/17;
let minSize = 3;

// SOME RANDOM COLOURS https://color.adobe.com/create/color-wheel/
const colorArray1 = [
	'#DEFCF5',
	'#BAFFE5',
	'#FFF5F5',
	'#A3FFE5',
	'#96F0DE'
];
const colorArray2 = [
	'#8C5523',
	'#FFC38C',
	'#FF9B40',
];
const colorArray3 = [
	'#3B9994',
	'#8BCCC9',
	'#C8FFDD',
	'#FF88AE',
	'#CC6CBB'
];
const colorArray4 = [
	'#9ec4f7',
	'#21A4D3',
	'#048CAC',
	'#145674',
	'#023855'
];
// CREATE PARTICLE OBJECT ///////////////////
function Particle(x, y, dx, dy, size, color, density, bounceFactor, vy, randomize){
	this.x = x;
	this.y = y;
	this.dx = dx;
	this.dy = dy;
	this.size = size;
	this.minSize = size;
	if (sliderValue == 1){
		this.color = colorArray1[Math.floor(Math.random()*colorArray1.length)];
	} else if (sliderValue == 2){
		this.color = colorArray2[Math.floor(Math.random()*colorArray2.length)];
	}else if (sliderValue == 3){
		this.color = colorArray3[Math.floor(Math.random()*colorArray3.length)];
	}else if (sliderValue == 4){
		this.color = colorArray4[Math.floor(Math.random()*colorArray4.length)];
	}
	this.density = 0.3 + (Math.random() * 0.2)+0.1;
	this.bounceFactor = 0.7;
	this.vy = 1;
	this.randomize = (Math.random() * 1)+15;
	this.draw = function(){
		//ctx.clearRect(0,0,innerWidth,innerHeight);
		ctx.beginPath();
		ctx.arc(this.x,this.y,this.size,0,Math.PI * 2, false);
		if (sliderValue == 5){
			ctx.strokeStyle = '#000';
			ctx.stroke();
		}
		ctx.fillStyle = this.color;
		ctx.fill();
	}
	
	
	this.update = function(){
		//////////////////////////////// EFFECT 1 ////////////////////////////
		if (activeEffect == 1){
			if (this.x + this.size > canvas.width || this.x - this.size < 0){
				this.dx = -this.dx;
			}
			if (this.y + this.size > canvas.height || this.y - this.size < 0){
				this.dy = -this.dy;
			}
			this.x += this.dx; 
			this.y += this.dy;

			//interactivity mouse
			if (mouse.x - this.x < 50 && mouse.x - this.x >-50 &&
				mouse.y - this.y < 50 && mouse.y - this.y >-50){
				if (this.size < maxSize){
					this.size += 1;
				}
			}
			else if (this.size > this.minSize){
				this.size -= 0.1;
			}
	
		}
		//////////////////////////////// EFFECT 2 ////////////////////////////
		if (activeEffect == 2){
			angle += 0.00001;
				this.y += this.density*5;
				this.x += Math.sin(angle) * .3;
			
				// if it reaches bottom add new one to the top
				if (this.y > canvas.height + 10){
						this.x = Math.random() * (innerWidth - size * 2) + size;
						this.y = -10;
				};
				/// bouncing from mouse
				if (mouse.x - this.x < this.density*100 && mouse.x - this.x >0 &&
				mouse.y - this.y < this.density*40 && mouse.y - this.y >-this.density*40){
				this.x-=2;
				this.y-=2;
				}
				if (mouse.x - this.x < 0 && mouse.x - this.x >-this.density*100 &&
				mouse.y - this.y < this.density*40 && mouse.y - this.y >-this.density*40){
				this.x+=3;
				this.y-=2;
				}		
		} 
		//////////////////////////////// EFFECT 3 ////////////////////////////
		if (activeEffect == 3){
				this.size+=0.15;
				if (this.x < innerWidth/2 && this.y < innerHeight/2){
					this.x-=2;
					this.y-=0.9 ;
				}
				if (this.x < innerWidth/2 && this.y > innerHeight/2){
					this.x-=2;
					this.y+=0.9;
				}
				if (this.x > innerWidth/2 && this.y > innerHeight/2){
					this.x+=2;
					this.y+=0.9;
				}
				if (this.x > innerWidth/2 && this.y < innerHeight/2){
					this.x+=2;
					this.y-=0.9;
				}
				if (this.x < 0-this.size || this.x > innerWidth+this.size){
					this.x =  innerWidth/2 + (Math.random() * innerWidth/2)-innerWidth/4;
					this.y =  innerHeight/2 + (Math.random() * innerHeight/2)-innerHeight/4;
					this.size = 1;
				}
				if (this.y < 0-this.size || this.y > innerHeight+this.size){
					this.x =  Math.random() * innerWidth;
					this.y =  Math.random() * innerHeight;
					this.size = 1;
				}
				//interactivity
				if (mouse.x - this.x < 50 && mouse.x - this.x > -50 &&
				mouse.y - this.y < 50 && mouse.y - this.y >0){
					this.y-=4;
					//this.x+=(Math.random() * 1)-0.5;
				}
				if (mouse.x - this.x < 50 && mouse.x - this.x > -50 &&
				mouse.y - this.y < 0 && mouse.y - this.y >-50){
					this.y+=4;
					//this.x+=(Math.random() * 1)-0.5;
				}
		}
		//////////////////////////////// EFFECT 4 ////////////////////////////
		if (activeEffect == 4){
				//this.density = (Math.random() * 1)-0.5;
				this.y += this.vy;
				this.vy += this.density;
									
				// if it reaches bottom add new one to the top
				if (this.y > canvas.height-this.size){
						this.vy *= -this.bounceFactor;
				};
				
				if ((this.y > innerHeight - innerHeight/5) &&(mouse.x - this.x < 20 && mouse.x - this.x >-20 &&
				mouse.y - this.y < 1250 && mouse.y - this.y >-1250)){
				//this.x+=1;
				this.vy-=2.7;
				}
		}
		//////////////////////////////// EFFECT 5 ////////////////////////////
		if (activeEffect == 5){
				angle += this.density/innerWidth*50;
				//this.vy += this.density;
				this.y -= this.density+this.randomize/30;
				this.x = this.x + Math.sin(angle);
				this.size += this.density/2;

				// if it reaches 'maxSize-6' make it transparent
				if (this.size > maxSize){
						this.color = "rgba(255, 255, 255, 0.6)";
				};
				
				// if it reaches 'maxSize' pop and add one to the bottom of screen
				if (this.size > maxSize+this.randomize){
						this.y = innerHeight/2 + (Math.random()*innerHeight/4)+innerHeight/4;
						this.x = (Math.random()*innerWidth*2)-innerWidth;
						this.size = (Math.random() * 0.1)+0.1;
						this.vy = 0.01;
						if (sliderValue == 1){
							this.color = colorArray1[Math.floor(Math.random()*colorArray1.length)];
						} else if (sliderValue == 2){
							this.color = colorArray2[Math.floor(Math.random()*colorArray2.length)];
						} else if (sliderValue == 3){
							this.color = colorArray3[Math.floor(Math.random()*colorArray3.length)];
						} else if (sliderValue == 4){
							this.color = colorArray4[Math.floor(Math.random()*colorArray4.length)];
					}
				};
				//interactivity
				if (mouse.x - this.x < 50 && mouse.x - this.x > -50 &&
				mouse.y - this.y < 50 && mouse.y - this.y >-50){
					this.size+=2;
				}
		}
		//////////////////////////////// EFFECT 6 ////////////////////////////
		if (activeEffect == 6){
			if (this.x + this.size > canvas.width || this.x - this.size < 0){
				this.dx = -this.dx;
			}
			if (this.y + this.size > canvas.height || this.y - this.size < 0){
				this.dy = -this.dy;
			}
			this.x += this.dx; 
			this.y += this.dy;

			//interactivity mouse
			if (mouse.x - this.x < 50 && mouse.x - this.x >-50 &&
				mouse.y - this.y < 50 && mouse.y - this.y >-50){
				if (this.size < maxSize){
					this.size += 1;
				}
			}
			else if (this.size > 0.11){
				this.size -= 0.1;
			}
			else if (this.size = 0.1){
				this.size = 0;
			}
		}
		//////////////////////////////// EFFECT 7 ////////////////////////////
		if (activeEffect == 7){
			this.size-=0.05;
			if (this.size < 0.1) {
				this.x = (mouse.x + ((Math.random() * 20) - 10));
				this.y = (mouse.y + ((Math.random() * 20) - 10));
				this.size = Math.random()*10;
				this.vy = ((Math.random()*1)-0.5);
			}
			this.y += this.vy;
			this.vy += 0.1;
								
			// if it reaches bottom bounce
			if (this.y > canvas.height-this.size){
					this.vy *= -this.bounceFactor;
			};
		}
		//////////////////////////////// EFFECT 8 ////////////////////////////
		if (activeEffect == 8){
			this.size+=0.08;
			
			if (this.size > 20) {
				this.x = (mouse.x + ((Math.random() * 20) - 10));
				this.y = (mouse.y + ((Math.random() * 20) - 10));
				this.size = 0;
				this.vy = Math.random()*1.1;
			}
			this.y -= this.vy;
			this.vy = Math.random()*1.1;					
			// if it reaches bottom bounce
			if (this.y > canvas.height-this.size){
					this.vy *= -this.bounceFactor;
			};
		}
	this.draw();
	}
}

// RESIZE SETTING - empty and refill particle array every time window changes size + change canvas size
window.addEventListener('resize',
	function(){
		canvas.width = innerWidth;
		canvas.height = innerHeight;
		maxSize = innerWidth/15;
		init();
	}
)

function init() {
updateText();
if (activeEffect <= 5){
		particleArray = [];
		for (let i = 0; i < innerWidth/2; i++){
			let size = Math.random() * innerHeight/80 + innerHeight/350; //PARTICLE SIZE DEPENDING ON WINDOW HEIGHT
			let x = Math.random() * (innerWidth - size * 2) + size;
			let y = Math.random() * (innerHeight - size * 2) + size;
			let dx = (Math.random() - 0.5) * .5;
			let dy = (Math.random() - 0.5) * .5;
			let density = Math.random() + 1 //determines how fast it falls;
			particleArray.push(new Particle(x, y, dx, dy, size));
		}
} else if (activeEffect == 6){
		particleArray = [];
		for (let i = 0; i < innerWidth*2; i++){
			let size = 0;
			let x = Math.random() * (innerWidth - size * 2) + size;
			let y = Math.random() * (innerHeight - size * 2) + size;
			let dx = (Math.random() - 0.5) * .5;
			let dy = (Math.random() - 0.5) * .5;
			let density = Math.random() + 1 //determines how fast it falls;
			particleArray.push(new Particle(x, y, dx, dy, size));
			let minSize = 0;
			let maxSize = 20;
		}
} else if (activeEffect == 7){
		particleArray = [];
		for (let i = 0; i < innerWidth/5; i++){
			let size = (Math.random() * 15) - 5;
			let x = (mouse.x + ((Math.random() * 20) - 10));
			let y = (mouse.y + ((Math.random() * 20) - 10));
			let dx = (Math.random() * 0.5) - .5;
			let dy = (Math.random() * 0.5) - .5;
			let density = Math.random() + 1; //determines how fast it falls;
			particleArray.push(new Particle(x, y, dx, dy, size));
		}
} else if (activeEffect == 8){
		particleArray = [];
		for (let i = 0; i < innerWidth/2; i++){
			let size = (Math.random() * 1) -0.5;
			let x = (mouse.x + ((Math.random() * 20) - 10));
			let y = (mouse.y + ((Math.random() * 20) - 10));
			let dx = (Math.random() * 0.5) - .5;
			let dy = (Math.random() * 0.5) - .5;
			let density = Math.random() + 20; //determines how fast it falls;
			particleArray.push(new Particle(x, y, dx, dy, size));
		}
}
}
// ANIMATION LOOP ///////////////////////////////////////
function animate(){
	requestAnimationFrame(animate);
	ctx.clearRect(0,0,innerWidth,innerHeight);
	
	for (let i = 0; i < particleArray.length; i++){
		particleArray[i].update();
	}
}
init();
animate();

//CONTROLS, BUTTONS 1 - 5 ////////////////////////////
const buttons = document.querySelectorAll('.button');
buttons.forEach(button => button.addEventListener('click', function(){
	//console.log(this.classList);
	for (let i = 0; i < buttons.length; i++){
		buttons[i].classList.remove('active');
	}
	this.classList.add('active');
	activeEffect = this.textContent;
	activeMode = this.dataset.mode;
	//console.log(this.dataset.mode);
	init();
	updateText();
}))
// SLIDER INPUT /////////////////////////////
slider.addEventListener('change', function(){
	sliderValue = slider.value;
	console.log(sliderValue);
	if (sliderValue == 1) {
		canvas.style.background = 'linear-gradient(#25364f, #4d71a5, #9bc4ff)';
		current_colour = 'Stratosphere';
	}else if (sliderValue == 2) {
		canvas.style.background = 'linear-gradient(#7F5026, #CC7C33)';
		current_colour = 'Sandstorm';
	}else if (sliderValue == 3) {
		//canvas.style.background = 'linear-gradient(red 10%,yellow 50%, blue 90%)';
		canvas.style.background = 'radial-gradient(#fff, #C8FFDD, #FF88AE)';
		current_colour = 'Flower';
	}else if (sliderValue == 4){
		canvas.style.background = 'linear-gradient(to top left,  #000, #2FC1E4, white)';
		current_colour = 'Ocean';
	} else {
		canvas.style.background = 'white';
	}
	init();
	updateText();
})

function updateText(){
	p_current.innerHTML = '<p>Movement mode: ' + activeMode + '</p><p>Colour scheme: ' + current_colour + '</p>'; 
}
</script>

</body>
</html>

